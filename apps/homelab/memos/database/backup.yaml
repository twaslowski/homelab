apiVersion: postgresql.cnpg.io/v1
kind: ScheduledBackup
metadata:
  name: scheduled-backup
spec:
  cluster:
    name: memos-pg
  method: plugin
  schedule: "0 0 3 * * *"
  pluginConfiguration:
    name: barman-cloud.cloudnative-pg.io
---
apiVersion: barmancloud.cnpg.io/v1
kind: ObjectStore
metadata:
  name: backup-store
spec:
  configuration:
    destinationPath: s3://246770851643-eu-central-1-homelab-cluster-storage/backups/memos/memos/
    endpointURL: https://s3.eu-central-1.amazonaws.com
    s3Credentials:
      accessKeyId:
        name: aws-creds
        key: aws_access_key_id
      secretAccessKey:
        name: aws-creds
        key: aws_secret_access_key
    wal:
      compression: gzip
---
apiVersion: barmancloud.cnpg.io/v1
kind: ObjectStore
metadata:
  name: backup-store-dr
spec:
  configuration:
    destinationPath: s3://246770851643-eu-central-1-homelab-cluster-storage/backups/memos/memos-dr/
    endpointURL: https://s3.eu-central-1.amazonaws.com
    s3Credentials:
      accessKeyId:
        name: aws-creds
        key: aws_access_key_id
      secretAccessKey:
        name: aws-creds
        key: aws_secret_access_key
    wal:
      compression: gzip